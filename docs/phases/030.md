# Title [PF-168]: Integrate Google Maps API config and reusable pkg-level client

## Type

Task

## Description

Integrate Google Maps API configuration into the application and implement a reusable, pkg-level Google Maps client. This client will support address autocomplete suggestions and place resolution using the Google Places API (New), exposing typed DTOs and following existing error-handling conventions. This establishes a single, testable integration point for all address-related features.

## Scope

* Add configuration wiring for `PACKFINDERZ_GOOGLE_MAPS_API_KEY` via env + `pkg/config`
* Ensure key is loaded during application/bootstrap initialization
* Create reusable `pkg/maps` (or equivalent) client
* Implement helpers for:

  * Autocomplete Suggestions (Places API New)
  * Place Resolve / Details (Places API New)
* Define typed request/response DTOs for both APIs
* Wrap and classify errors using existing `pkg/errors` patterns
* Add minimal unit tests for:

  * Request construction (headers, body)
  * Response parsing/mapping

**Explicitly NOT included**

* HTTP controllers or routing
* Rate limiting
* Frontend-specific normalization
* Any live API keys or secrets

## Acceptance Criteria

* [ ] Application loads `PACKFINDERZ_GOOGLE_MAPS_API_KEY` from env/config without exposing it in code
* [ ] `pkg/maps` exposes typed helpers for autocomplete and place resolve
* [ ] Google API requests include correct headers and field masks
* [ ] Responses are parsed into typed DTOs with lat/lng extracted
* [ ] Unit tests validate request formation and response mapping

## Dependencies

* Blocked by: None
* Blocks: Public address HTTP endpoints (controller/service layer)

## Technical Notes

* APIs used:

  * `POST /v1/places:autocomplete`
  * `GET /v1/places/{placeId}`
* Headers MUST include:

  * `X-Goog-Api-Key: <PACKFINDERZ_GOOGLE_MAPS_API_KEY>`
  * `X-Goog-FieldMask: ...`
    - suggest: suggestions.placePrediction.placeId,suggestions.placePrediction.text
    - resolve: id,formattedAddress,location,addressComponents
* Package location: `pkg/maps`
* **ASSUMPTION:** outbound HTTP client utilities already exist or standard `net/http` is acceptable


## Master Context (authoritative constraints + reference)

### Google APIs used
- Autocomplete:
  - POST `https://places.googleapis.com/v1/places:autocomplete`
  - Headers:
    - `Content-Type: application/json`
    - `X-Goog-Api-Key: <SECRET>`
    - `X-Goog-FieldMask: suggestions.placePrediction.placeId,suggestions.placePrediction.text`
  - Body example:
    ```json
    { "input": "123 15th st sw", "includedRegionCodes": ["US"], "languageCode": "en" }
    ```
  - Response includes:
    - `suggestions[].placePrediction.placeId`
    - `suggestions[].placePrediction.text.text`

- Place Details (Resolve):
  - GET `https://places.googleapis.com/v1/places/{placeId}`
  - Headers:
    - `X-Goog-Api-Key: <SECRET>`
    - `X-Goog-FieldMask: id,formattedAddress,location,addressComponents`
  - Response includes:
    - `formattedAddress`
    - `addressComponents[]` with types like `street_number`, `route`, `locality`, `administrative_area_level_1`, `postal_code`, `country`
    - `location.latitude`, `location.longitude`


## Out of Scope

* Caching or persistence
* Geohash computation
* Quota or billing enforcement

---

# Title [PF-169]: Add public address suggest and resolve HTTP endpoints

## Type

Feature

## Description

Implement public HTTP endpoints for address autocomplete and address resolution using the reusable Google Maps client. This includes controller, routing, service, DTOs, and mappers to return normalized, stable address data for frontend consumption, with public rate limiting applied.

## Scope

* Add controller under `api/controllers/<domain>` following existing patterns
* Register routes in `api/routes/router.go` (or equivalent):

  * `GET /api/address/suggest`
  * `POST /api/address/resolve`
* Enforce existing public rate-limiting middleware
* Create domain module under `internal/address` (or `internal/geo`) including:

  * Service layer calling `pkg/maps`
  * Request/response DTOs
  * Mapper converting Place Details â†’ `pkg/types.Address`
* Normalize responses to a stable frontend-facing shape
* May need to wire to the binary to be used in api endpoint. if so, bootrap as well. 

**Explicitly NOT included**

* UI changes
* Persistent storage of addresses
* Geohash computation (unless already part of existing address helpers)
* Auth-required endpoints

## Acceptance Criteria

* [ ] `GET /api/address/suggest` returns autocomplete suggestions based on query, country, and language
* [ ] `POST /api/address/resolve` resolves a place_id into a normalized Address with lat/lng
* [ ] Rate limiting middleware is enforced on both endpoints (existing middleware repurposed)
* [ ] Address mapping correctly fills Line1, City, State, PostalCode, Country, Lat, Lng
* [ ] Responses are consistent and stable for frontend use

## Dependencies

* Blocked by: Reusable Google Maps client (`pkg/maps`)
* Blocks: Store creation/edit flows that rely on address resolution

## Technical Notes

* Mapper output target:

  ```go
  pkg/types.Address
  ```
* Country and language parameters MUST be optional but validated
* **ASSUMPTION:** `pkg/types.Address` is the canonical address shape used across the app

## Out of Scope

* Internationalization beyond Google-provided language support
* Address verification beyond Google Places data
* Admin-only or authenticated address endpoints

