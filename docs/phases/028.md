# Title [PF-251]: Wire license ↔ media attachments

## Type

Feature

## Description

Enable licenses upload to create a new `media_attachment` row attatching a `media` assets (e.g., `media_kind`: `license_doc`) so compliance artifacts can be attached, retrieved, and managed consistently across the system.

This ensures licenses can carry verifiable documentation without duplicating file storage logic.

## Scope

* Associate new license records with media records via `media_attachment` record (1:1 where a media can have 0:MANY but a attatchment can only be associated with one entity per record)
* Enforce correct delete semantics (no orphaned joins)

**NOT included**

* License upload UI
* Media processing (compression, OCR, validation)
* Compliance approval workflows
* Recursive Detatchment via GCS pubsub consumer
* Generating a new endpoint

## Acceptance Criteria

* [ ] License can be created or updated with associated `media_id` references
* [ ] `media_attachment` created with associated `media_id` and `license_id` references
* [ ] Media records are not deleted while still referenced by a license

## Dependencies

* Blocked by: Media table + upload flow existing
* Blocks: None

## Technical Notes

* Services: `licenses`, `media`, `media_atatchment`
* Tables: `licenses`, `media`, `license_media` (join table or equivalent)
* APIs: License create/update/read endpoints
* **ASSUMPTION:** Media records are reusable and reference-counted logically (not hard-deleted on detach)

## Out of Scope

* License verification logic
* Admin compliance tooling
* genreating new table or API endpoint

---

# [INCOMPLETE ❌] Title [PF-252]: Wire product ↔ media attachments (gallery and COA)

## Type

Feature

## Description

Enable products to reference media assets for both product galleries and COA (Certificate of Analysis) documents. This allows products to surface images and compliance documents while reusing the shared media system.

## Scope

* Associate products with multiple media records
* Distinguish between gallery media and COA media
* Return attached media when fetching product data
* Enforce safe delete semantics for attachments

**NOT included**

* Media upload UX
* COA parsing or extraction
* Product moderation logic

## Acceptance Criteria

* [ ] Product can be created or updated with `media_ids`
* [ ] Product response includes gallery and COA media metadata
* [ ] Removing a media association does not delete the media if referenced elsewhere
* [ ] Deleting a product removes only product↔media associations

## Dependencies

* Blocked by: Media upload + storage flow
* Blocks: None

## Technical Notes

* Services: `products`, `media`
* Tables: `products`, `media`, `product_media`
* APIs: `POST /vendor/products`, product update endpoints
* **ASSUMPTION:** COA media is differentiated via a media type or role field

## Out of Scope

* COA validation
* Search or filtering by media attributes

---

# [INCOMPLETE ❌] Title [PF-253]: Wire store ↔ media attachments (logo and banner)

## Type

Feature

## Description

Allow stores to reference media assets for branding purposes (logo and banner). This enables consistent branding across marketplace surfaces while keeping media management centralized.

## Scope

* Associate store records with logo and banner media
* Support updating or replacing store branding assets
* Return branding media in store fetch responses

**NOT included**

* Image resizing or transformations
* Store profile UI
* CDN configuration

## Acceptance Criteria

* [ ] Store can reference a logo media ID
* [ ] Store can reference a banner media ID
* [ ] Fetching store data returns logo and banner metadata
* [ ] Replacing branding updates associations without deleting shared media

## Dependencies

* Blocked by: Media system availability
* Blocks: None

## Technical Notes

* Services: `stores`, `media`
* Tables: `stores`, `media`
* APIs: Store update/read endpoints
* **ASSUMPTION:** Store has dedicated nullable fields for logo and banner media IDs

## Out of Scope

* Branding validation rules
* Theme or layout logic

---

# [INCOMPLETE ❌] Title [PF-254]: Wire user ↔ media attachments (avatar)

## Type

Feature

## Description

Enable users to attach an avatar image via the shared media system. This ensures user profile images follow the same lifecycle and deletion semantics as other attachments.

## Scope

* Associate a user with a single avatar media record
* Allow updating or clearing the avatar
* Return avatar media metadata when fetching user profiles

**NOT included**

* User profile UI
* Image cropping or resizing
* Social features

## Acceptance Criteria

* [ ] User can set or update an avatar via `media_id`
* [ ] Fetching user profile returns avatar media metadata
* [ ] Clearing avatar removes the association without deleting media
* [ ] Media is not deleted while referenced by another entity

## Dependencies

* Blocked by: Media table + upload flow
* Blocks: None

## Technical Notes

* Services: `users`, `media`
* Tables: `users`, `media`
* APIs: User update/read endpoints
* **ASSUMPTION:** User model supports nullable avatar media reference

## Out of Scope

* Avatar moderation
* Presence or activity features
